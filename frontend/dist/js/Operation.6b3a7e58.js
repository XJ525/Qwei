(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["Operation"],{"63e9":function(t,e,s){},cc87:function(t,e,s){"use strict";s("63e9")},f227:function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("van-nav-bar",{staticClass:"head",attrs:{"left-text":"返回","left-arrow":"",title:"修改角色"},on:{"click-left":t.onClickLeft}}),s("van-cell-group",[s("van-field",{attrs:{label:"角色名",maxlength:"9",placeholder:"请输入新角色名"},model:{value:t.username,callback:function(e){t.username=e},expression:"username"}})],1),s("div",{staticClass:"checkbox"},t._l(t.allpower,(function(e,a){return s("div",{key:a,staticClass:"btn"},["1"==t.state[a]?s("van-button",{ref:"yess",refInFor:!0,staticClass:"checked",attrs:{plain:"",type:"info","data-key":a},on:{click:t.switchs}},[t._v(t._s(e))]):s("van-button",{ref:"yess",refInFor:!0,staticClass:"nochecked",attrs:{plain:"","data-key":a,type:"info"},on:{click:t.switchs}},[t._v(t._s(e))])],1)})),0),s("div",{staticClass:"sub"},[""!=t.username?s("van-button",{staticClass:"subm",attrs:{type:"info"},on:{click:t.submits}},[t._v("更新角色")]):s("van-button",{staticClass:"subm",attrs:{type:"info",disabled:""},on:{click:t.submits}},[t._v("更新角色")])],1)],1)},i=[],o={data(){return{power:{},allpower:{},state:{},username:""}},methods:{switchs(){this.$refs.yess.forEach((t,e)=>{if(t==event.target){let e=t.getAttribute("class");t.getAttribute("data-key");e.indexOf("nochecked")>=0?t.setAttribute("class","checked van-button van-button--info van-button--normal van-button--plain"):e.indexOf("checked")>=0&&t.setAttribute("class","nochecked van-button van-button--info van-button--normal van-button--plain")}})},onClickLeft(){this.$router.push({path:"/about/role"})},submits(){this.Toast.loading({message:"修改中...",forbidClick:!0,loadingType:"spinner",duration:0}),this.$axios.post({url:"/role/update",data:{roleid:this.$route.params.id,role_name:this.username}}).then(t=>{if(console.log(t),t&&t.code&&"0"==t.code){let t=[];this.$refs.yess.forEach((e,s)=>{let a=e.getAttribute("class");a.indexOf("nochecked")<0&&t.push(e.getAttribute("data-key"))}),this.$axios.post({url:"role_and_perm/alter",data:{rid:this.$route.params.id,data:"["+t+"]"}}).then(t=>{if(t&&"0"==t.code)return this.Toast.success("更新角色成功"),void this.$router.push({path:"/about/role"});this.Toast.fail("更新角色失败")})}else this.Toast.fail("更新角色失败")})}},mounted(){this.$axios.post({url:"/role/find",data:{roleid:this.$route.params.id}}).then(t=>{t&&t.role_name?this.username=t.role_name:this.Toast.fail("获取角色失败")});let t={};this.$axios.get({url:"/power/select"}).then(e=>{if(e instanceof Array){let s={};e.forEach(e=>{e.pid>0&&e.parent_id>=0&&(s[e.pid]=e.pname,t[e.pid]="0")}),console.log(s),this.allpower=s,this.$axios.get({url:"/role/permissions",params:{rid:this.$route.params.id}}).then(e=>{if(e&&e.code&&"-2"==e.code)this.Toast.fail("该角色没有权限");else if(e instanceof Array){let s={};e.forEach(e=>{s[e.pid]=e.pname,t[e.pid]="1"}),this.power=s,this.state=t}else this.Toast.fail("获取角色信息错误")})}else this.Toast.fail("该角色无权限")}),console.log(this.state)}},n=o,r=(s("cc87"),s("2877")),l=Object(r["a"])(n,a,i,!1,null,"4abfebb8",null);e["default"]=l.exports}}]);
//# sourceMappingURL=Operation.6b3a7e58.js.map