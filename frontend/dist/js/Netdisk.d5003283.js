(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["Netdisk"],{3739:function(t,e,i){"use strict";i("767e")},"5a94":function(t,e,i){t.exports=i.p+"img/资料.44e9b48b.png"},"767e":function(t,e,i){},"8b80":function(t,e,i){"use strict";i.r(e);var s=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"netdisk"},[s("div",{staticClass:"head"},[s("van-nav-bar",{staticClass:"mytitle",attrs:{title:"我的云盘","left-text":"返回","left-arrow":"",fixed:""},on:{"click-left":function(e){return t.$router.push("/about")}},scopedSlots:t._u([{key:"right",fn:function(){},proxy:!0}])})],1),s("div",{staticClass:"path"},[s("p",[s("span",{staticClass:"backon",class:{isbackon:t.isBackon},on:{click:t.backOn}},[t._v("文件位置：")]),s("span",{staticClass:"pathnow"},[t._v(" "+t._s(t.path)+" ")])])]),s("div",{staticClass:"main"},[t._l(t.dir,(function(e,a){return s("div",{key:-a-1,staticClass:"files"},[s("p",{staticClass:"file",on:{click:t.getInto}},[s("img",{attrs:{src:i("c7bd"),alt:""}})]),s("p",{staticClass:"fileName",on:{click:t.getInto}},[t._v(" "+t._s(e)+" ")]),s("p",{staticClass:"fileMenu",on:{click:function(e){return t.setDir(t.dir,a)}}},[s("span",{staticClass:"menu"},[t._v("···")])])])})),t._l(t.download,(function(e,a){return s("div",{key:a,staticClass:"download"},[s("p",{staticClass:"file",on:{click:function(i){return t.downloadFile(e)}}},[s("img",{attrs:{src:i("5a94"),alt:""}})]),s("p",{staticClass:"fileName",on:{click:function(i){return t.downloadFile(e)}}},[t._v(" "+t._s(e)+" ")]),s("p",{staticClass:"fileMenu",on:{click:function(e){return t.setDir(t.download,a)}}},[s("span",{staticClass:"menu"},[t._v("···")])])])}))],2),s("van-button",{staticClass:"createFile",attrs:{icon:"plus",type:"primary",round:!0},on:{click:t.createFile}}),s("van-popup",{style:{height:"30%"},attrs:{round:"",position:"bottom"},model:{value:t.show,callback:function(e){t.show=e},expression:"show"}},[s("p",{style:{textAlign:"center",fontSize:"1.2rem",padding:"1rem"}},[t._v("请选择")]),s("div",{staticClass:"myNewFile",on:{click:t.createDir}},[s("div",{staticClass:"newlyBuild"},[s("van-icon",{staticClass:"ico dirico",attrs:{name:"card"}}),s("p",[t._v("文件夹")])],1)]),s("div",{staticClass:"myNewFile",on:{click:t.trigger}},[s("div",{staticClass:"newlyBuild"},[s("van-icon",{staticClass:"ico fileico",attrs:{name:"column"}}),s("p",[t._v("上传文件")])],1),s("input",{ref:"fileBtn",style:{display:"none"},attrs:{type:"file",id:"uploadFile",multiple:"multiple"}})])]),s("van-popup",{staticClass:"newfile",attrs:{closeable:"","close-icon-position":"top-left",position:"bottom"},model:{value:t.createDirShow,callback:function(e){t.createDirShow=e},expression:"createDirShow"}},[s("div",{staticClass:"myNewFiles"},[s("div",{staticClass:"newlyBuilds"},[s("p",[t._v("新建文件夹")])])]),s("div",{staticClass:"inputDirName"},[s("p",{staticClass:"inputDirNameImage"},[s("img",{attrs:{src:i("c7bd"),alt:""}})]),s("p",{staticClass:"input"},[s("van-cell-group",[s("van-field",{staticClass:"projectname",attrs:{placeholder:"输入文件夹名称","input-align":"center"},model:{value:t.dirName,callback:function(e){t.dirName=e},expression:"dirName"}})],1)],1),s("p",{staticClass:"btnConfirm"},[""!=t.dirName?s("van-button",{staticClass:"confirmbtn",attrs:{hairline:"",type:"info"},on:{click:t.confirmCreateFile}},[t._v("确认")]):s("van-button",{staticClass:"confirmbtn",attrs:{hairline:"",type:"info",disabled:""},on:{click:t.confirmCreateFile}},[t._v("确认")])],1)])]),s("van-popup",{style:{height:"26%"},attrs:{position:"bottom",round:""},model:{value:t.rmDirShow,callback:function(e){t.rmDirShow=e},expression:"rmDirShow"}},[s("p",{staticClass:"setFileName"},[t._v(" "+t._s(t.setDirArr[0])+" ")]),s("p",{staticClass:"rmDirs",on:{click:function(e){return t.setFileName(t.setDirArr[0])}}},[t._v(" 重命名")]),s("p",{staticClass:"rmDirs",on:{click:function(e){return t.filemove(t.setDirArr[0])}}},[t._v(" 拷贝")]),s("p",{staticClass:"rmDirs",on:{click:t.delDir}},[t._v("删除")])]),s("van-popup",{style:{height:"7%"},attrs:{position:"top"},model:{value:t.showQuery,callback:function(e){t.showQuery=e},expression:"showQuery"}},[s("div",{staticClass:"querysClick"},[s("van-field",{style:{height:"100%"},attrs:{center:"",clearable:"",placeholder:"请输入新的文件名"},scopedSlots:t._u([{key:"button",fn:function(){return[s("van-button",{staticClass:"btn",attrs:{plain:"",type:"info"},on:{click:t.setFileNamecuss}},[t._v("    确定    ")])]},proxy:!0}]),model:{value:t.newfileName,callback:function(e){t.newfileName=e},expression:"newfileName"}})],1)])],1)},a=[],n={name:"Netdisk",data(){return{path:"/",dir:[],download:[],setDirArr:[],backonStr:0,code:"0",message:"",dirName:"",userId:"",show:!1,createDirShow:!1,rmDirShow:!1,isBackon:!1,fontWeight:!0,newfileName:"",oldfilename:"",showQuery:!1,setFielArr:[],index:0}},mounted(){let t=localStorage.getItem("filemovepath");if(null!=t){let e=JSON.parse(t);this.filecopy(e),localStorage.removeItem("filemovepath")}this.rander()},methods:{rander(){this.Toast.loading({message:"",forbidClick:!0,duration:1e4}),this.$axios.post({url:"netdisk/readfile",data:{pathnow:this.path}}).then(t=>{this.Toast.clear(),t&&0==t.code?(this.download=t.file.sort(),this.dir=t.dir.sort(),this.userId=t.userId):(this.code=t.code,this.message=t.message)})},getInto(){this.backonStr++,this.backonStr>=0&&(this.isBackon=!0);let t="";t="/"==this.path?this.path+event.currentTarget.parentNode.children[1].textContent:this.path+"/"+event.currentTarget.parentNode.children[1].textContent,t=t.replace(/\s*/g,""),this.$axios.post({url:"/netdisk/readfile",data:{pathnow:t}}).then(e=>{0==e.code?(this.download=e.file.sort(),this.dir=e.dir.sort(),this.path=t):(this.download=[],this.dir=[],this.path=t,this.code=e.code,this.message=e.message)})},backOn(){this.backonStr--,this.backonStr<=0&&(this.isBackon=!1);let t="";"/"!=this.path?(t=this.path.substr(0,this.path.lastIndexOf("/")),""==t&&(t="/"),this.$axios.post({url:"/netdisk/readfile",data:{pathnow:t}}).then(e=>{0==e.code?(this.download=e.file.sort(),this.dir=e.dir.sort(),this.path=t,this.code=e.code):(this.path=t,this.code=e.code,this.message=e.message)})):console.log("已达最上层目录")},createFile(){this.show=!0},createDir(){this.show=!1,this.createDirShow=!0},confirmCreateFile(){let t=this.dirName;if(t=t.match(/^[\u4E00-\u9FA5A-Za-z0-9]+/),t[0]==t["input"]){for(let e=0;e<this.dir.length;e++)this.dir[e]==t&&this.Toast.fail("文件名重复");this.$axios.post({url:"/netdisk/createdir",data:{dirname:t,pathnow:this.path}}).then(e=>{0==e.code?(this.dir.unshift(t[0]),this.Toast.success("创建成功"),this.createDirShow=!1,this.rander(),this.code=e.code):(this.code=e.code,this.createDirShow=!1)}),this.dirName=""}else this.Toast.fail("文件名不正确")},setDir(t,e){this.setFielArr=t,this.index=e;let i=event.currentTarget.parentNode.children[1].textContent;this.setDirArr=[i],this.rmDirShow=!0},delDir(){this.Dialog.confirm({title:"删除此文件夹",message:"文件的历史版本将一并删除，确认是否将文件删除？"}).then(()=>{let t=this.setDirArr[0],e=this.path+"/"+t;e=e.replace(/\s*/g,""),this.$axios.post({url:"/netdisk/delfile",data:{pathnow:e}}).then(t=>{0==t.code?(this.rmDirShow=!1,this.rander()):console.log(t.message)})})},trigger(){this.$refs.fileBtn.dispatchEvent(new MouseEvent("click"));let t=this;event.currentTarget.children[1].onchange=function(){let e=new FormData,i=t.path;for(let t=0;t<this.files.length;t++)e.append("file",this.files[t]);e.append("path",i),t.$axios.post({url:"/netdisk/getupfile",data:e,headers:{"Content-Type":"multipart/form-data"}}).then(e=>{e&&0==e.code&&(t.rander(),t.show=!1)})}},downloadFile(t){t=this.userId+this.path+"/"+t;const e=document.createElement("a");e.style.display="none",e.href=`${i("f121").baseURL}/file/pan/${t}`,e.setAttribute("download",decodeURI(t)),"undefined"===typeof e.download&&e.setAttribute("target","_blank"),e.click(),this.Toast.success("开始下载")},setFileName(t){this.rmDirShow=!1,this.showQuery=!0,this.oldfilename=t.trim(),this.newfileName=t.trim()},setFileNamecuss(){let t=this.newfileName;if(""==t)return void this.Toast.fail("文件名为空");if(t=t.match(/^[\u4E00-\u9FA5A-Za-z0-9_]+\.?[\u4E00-\u9FA5A-Za-z0-9_]+$/),null==t)return void this.Toast.fail("文件名不正确");t=t[0];let e="/"==this.path?this.path+this.oldfilename:this.path+"/"+this.oldfilename,i="/"==this.path?this.path+this.newfileName:this.path+"/"+this.newfileName;this.$axios.post({url:"/netdisk/setfilename",data:{newName:i,oldName:e}}).then(e=>{0==e.code?(this.Toast.success("成功修改"),this.setFielArr==this.dir?this.dir[this.index]=t:this.download[this.index]=t):this.Toast.fail(e.message),this.showQuery=!1})},filemove(t){this.path=this.path.trim(),t=t.trim();let e="/"==this.path?this.path+t:this.path+"/"+t;localStorage.setItem("oldfilepath",e),this.$router.push("./netdisk/netdiskmove")},filecopy({oldfilepath:t,newfilepath:e}){this.$axios.post({url:"netdisk/copyfile",data:{oldfilepath:t,newfilepath:e}}).then(t=>{0==t.code&&(this.Toast.success("文件复制成功"),this.rander())})}}},o=n,l=(i("3739"),i("2877")),r=Object(l["a"])(o,s,a,!1,null,"620f7b6e",null);e["default"]=r.exports},c7bd:function(t,e,i){t.exports=i.p+"img/文件.6b90fd60.png"}}]);
//# sourceMappingURL=Netdisk.d5003283.js.map