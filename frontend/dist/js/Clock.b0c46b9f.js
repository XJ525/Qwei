(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["Clock"],{"5ca9":function(t,e,a){"use strict";a("ccf2")},"5f76":function(t,e,a){"use strict";var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"nav"},[a("van-tabbar",{attrs:{route:""}},[a("van-tabbar-item",{staticClass:"iconfont icon-dingwei index",attrs:{replace:"",to:"/clock"}},[a("span",[t._v("定位")])]),a("van-tabbar-item",{staticClass:"iconfont icon-renlian work",attrs:{replace:"",to:"/facematch"}},[a("span",[t._v("人脸")])]),a("van-tabbar-item",{staticClass:"iconfont icon-tongji my",attrs:{replace:"",to:"/stat"}},[a("span",[t._v("统计")])])],1)],1)},n=[],i=(a("5ca9"),a("2877")),l={},o=Object(i["a"])(l,s,n,!1,null,"ef51d1e4",null);e["a"]=o.exports},"9fde":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"clockbox"},[a("van-nav-bar",{attrs:{title:"考勤打卡","left-text":"返回","left-arrow":""},on:{"click-left":function(e){return t.$router.go(-1)}}}),a("div",{ref:"AMap"}),a("van-cell-group",{staticClass:"top clock",attrs:{inset:""}},[a("van-cell",{staticClass:"head",attrs:{center:"",title:"上班08:30"}}),a("van-cell",{attrs:{center:"",title:"下班17:30"}})],1),a("div",{staticClass:"content",on:{click:t.clock}},[a("p",[a("span",{staticClass:"p-span"},[t._v(t._s(t.state))]),a("span",{staticClass:"p-span"},[t._v(t._s(t.time))])])]),a("div",{staticClass:"cell-group"},[a("van-cell-group",{staticClass:"top lists",attrs:{inset:""}},[a("van-cell",{attrs:{center:"",title:"打卡记录"}}),a("div",{staticClass:"box_list"},[t._l(t.datas,(function(e,s){return a("div",{key:s,staticClass:"clock-list"},[0==s&&"当日没有打卡记录"!=e?a("van-cell",{attrs:{center:"",title:e.substr(-8),value:"上班打卡"}}):1==s?a("van-cell",{attrs:{center:"",title:e.substr(-8),value:"下班打卡"}}):s>=2?a("van-cell",{attrs:{center:"",title:e.substr(-8),value:"更新打卡"}}):t._e()],1)})),t.datas.length&&"当日没有打卡记录"==t.datas[0]?a("div",{staticClass:"contentdiv"},[t._v(" "+t._s(t.datas[0])+" ")]):t._e()],2)],1)],1),a("ClockNav",{attrs:{data:"clock"}})],1)},n=[],i=a("5f76"),l={name:"Clock",data(){return{list:[1,2,3,4],loading:!0,finished:!0,"finished-text":"",time:"",datas:[],AMap:null,position:{},state:"上班打卡"}},methods:{timeinit:function(){this.time=this.stampChangehHonurs(),setTimeout(()=>{this.time=this.stampChangehHonurs(),this.timeinit()},1e3)},stampChangehHonurs:function(){let t=(new Date).getHours(),e=(new Date).getMinutes(),a=(new Date).getSeconds();return`${this.add0(t)}:${this.add0(e)}:${this.add0(a)}`},add0(t){return t<10?"0"+t:t},async clock(){let t=!1;console.log(44545),await new Promise((e,a)=>{this.o.getCurrentPosition((a,s)=>{console.log(s),s&&s.position&&(self.lng=s.position.lng,self.lat=s.position.lat,self.center=[self.lng,self.lat],self.loaded=!0,"SUCCESS"==s.info&&(t=!0),e())})});let e=center;t&&this.$axios.post({url:"/punch_card/check",data:{location:JSON.stringify({lngs:e[0],lats:e[1]})}}).then(t=>{t&&t.code&&(this.getdata(),"-4"==t.code?this.Dialog.alert({title:"打卡失败",message:"不在打卡范围内。"}):"0"!=t.code&&"1"!=t.code||this.Dialog.alert({title:"打卡成功"}))})},getdata(){let t=new Date,e=t.getFullYear(),a=t.getMonth()+1,s=t.getDate();this.$axios.get({url:"/check/mycheck",params:{starT:new Date(`${e}-${a}-${s} 0:0:0`).getTime(),endT:new Date(`${e}-${a}-${s+1} 0:0:0`).getTime()-1}}).then(t=>{this.Toast.clear();let e=Object.keys(t)[0];if("-2"==t[e].code)return void(this.datas=["当日没有打卡记录"]);let a=[];1==t[e].message.length?this.state="下班打卡":t[e].message.length>1&&(this.state="更新打卡");for(let s=t[e].message.length-1;s>=0;s--)a.push(t[e].message[s]);console.log(a),this.datas=a})},async clock(){let t=this.AMap;function e(e){return new Promise((e,a)=>{let s={};var n=new t.Map("container",{resizeEnable:!0});function i(t){var a=[];a.push(t.position),e(a)}t.plugin("AMap.Geolocation",(async function(){var e=new t.Geolocation({enableHighAccuracy:!0,timeout:1e4,buttonPosition:"RB",buttonOffset:new t.Pixel(10,20),zoomToAccuracy:!0});n.addControl(e),await e.getCurrentPosition((function(t,e){"complete"==t?(s["lat"]=e.position.lat,s["lng"]=e.position.lng,i(e)):a()}))}))})}this.Toast.loading({message:"",forbidClick:!0,duration:1e6});let a=this,s={};await e().then(t=>{let e=t[0].lat,n=t[0].lng;s["lats"]=e,s["lngs"]=n,a.position=s,a.$axios.post({url:"/punch_card/check",data:{location:JSON.stringify(s)}}).then(t=>{t&&t.code&&(a.Toast.clear(),"-4"==t.code?a.Dialog.alert({title:"打卡失败",message:"不在打卡范围内。"}):"0"!=t.code&&"1"!=t.code||(a.getdata(),a.Dialog.alert({title:"打卡成功"})))})},t=>{a.Toast.clear(),a.Dialog.alert({title:"定位失败",message:"请刷新再试"})})}},mounted:function(){this.timeinit(),this.getdata(),this.Toast.loading({message:"",forbidClick:!0,duration:1e4});let t=document.createElement("script");t.src="https://webapi.amap.com/maps?v=1.4.15&key=d2de3b8aae1f6005cabc3872c6fc1fd1",this.$refs.AMap.appendChild(t),t.onload=()=>{this.AMap=AMap,this.Toast.clear()}},components:{ClockNav:i["a"]}},o=l,c=(a("c7ab"),a("2877")),r=Object(c["a"])(o,s,n,!1,null,"00dc7644",null);e["default"]=r.exports},c7ab:function(t,e,a){"use strict";a("cce0")},cce0:function(t,e,a){},ccf2:function(t,e,a){}}]);
//# sourceMappingURL=Clock.b0c46b9f.js.map